import{_ as Y,o as A,c as r,a as e,t,b,w as f,d as g,e as u,f as P,u as T,g as U,h as B,r as a,i as E,j as F,k as G,l}from"./index-C4NAgnXl.js";const $={class:"join-page"},D={class:"join-card"},L={key:0,class:"step-loading"},K={key:1,class:"step-error"},M={key:2,class:"step-auth"},R={class:"card-header-gradient"},W={class:"teacher-info"},z={class:"card-body-section"},q={key:0,class:"classroom-desc"},H={class:"auth-actions"},O={key:3,class:"step-confirm"},Q={class:"card-header-gradient"},X={class:"teacher-info"},Z={class:"card-body-section"},ss={class:"student-info"},es={key:0,class:"warning-box"},os={class:"step-actions"},ts=["disabled"],as={key:1,class:"error-text"},ns={key:4,class:"step-success"},rs={key:5,class:"step-success"},ls={__name:"JoinClassroomView",setup(is){const h=T(),S=G(),v=U(),_=B(),n=a("loading"),w=a(""),d=a(null),m=a(!1),p=a(""),k=a(""),y=a(""),C=a(null),j=a(null),V=a(null),x=a(""),J=a("");A(async()=>{const i=h.params.joinCode;v.initialize();const s=await _.fetchJoinInfo(i);if(!s){n.value="error",w.value=_.error.value||"This invite link is invalid or the classroom no longer exists.";return}if(p.value=s.classroom_name,k.value=s.classroom_description,y.value=s.teacher_name,C.value=s.teacher_viewer_id,j.value=s.teacher_public_key,!v.isAuthenticated.value){n.value="not-logged-in";return}const o=v.currentUser.value;x.value=`${o.firstName} ${o.lastName}`,J.value=o.email||"",n.value="confirm"});function N(){sessionStorage.setItem("pendingJoinCode",h.params.joinCode),S.push("/")}async function I(){const i=v.currentUser.value;if(!(!i||!j.value)){m.value=!0,d.value=null;try{let s="";try{s=await F(i.secretKey,j.value)}catch(c){console.error("Failed to create sharing grant:",c),d.value="Failed to create secure connection. Please try again.",m.value=!1;return}const o=await _.joinClassroom(h.params.joinCode,i.id,s);if(o.success)if(V.value=o.classroom_id,o.error&&o.error.includes("Already a member"))n.value="already-member";else{const c=i.classrooms||[];o.classroom_id&&!c.includes(o.classroom_id)&&v.updateUser(i.id,{classrooms:[...c,o.classroom_id]}),n.value="success"}else d.value=o.error||"Failed to join classroom. Please try again."}catch(s){console.error("Join failed:",s),d.value="Unable to connect to server. Please try again."}finally{m.value=!1}}}return(i,s)=>{const o=E("router-link");return l(),r("div",$,[e("div",D,[n.value==="loading"?(l(),r("div",L,[...s[2]||(s[2]=[e("p",null,"Loading classroom info...",-1)])])):n.value==="error"?(l(),r("div",K,[s[4]||(s[4]=e("div",{class:"error-icon"},"âš ",-1)),s[5]||(s[5]=e("h2",null,"Classroom Not Found",-1)),e("p",null,t(w.value),1),b(o,{to:"/",class:"btn btn-primary"},{default:f(()=>[...s[3]||(s[3]=[u("Go to Bridge Classroom",-1)])]),_:1})])):n.value==="not-logged-in"?(l(),r("div",M,[e("div",R,[s[6]||(s[6]=e("div",{class:"join-icon"},"â™ ",-1)),e("h2",null,t(p.value),1),e("p",W,"Taught by "+t(y.value),1)]),e("div",z,[k.value?(l(),r("p",q,t(k.value),1)):g("",!0),s[8]||(s[8]=e("p",{class:"auth-prompt"},"Sign in or create an account to join this classroom.",-1)),e("div",H,[e("button",{class:"btn btn-primary",onClick:s[0]||(s[0]=c=>N())},"Sign In to Join"),s[7]||(s[7]=e("div",{class:"divider-text"},"or",-1)),e("button",{class:"btn btn-secondary",onClick:s[1]||(s[1]=c=>N())},"Create an Account")])])])):n.value==="confirm"?(l(),r("div",O,[e("div",Q,[e("h2",null,"Join "+t(p.value),1),e("p",X,"Teacher: "+t(y.value),1)]),e("div",Z,[e("div",ss,[s[9]||(s[9]=e("strong",null,"Your account:",-1)),e("p",null,t(x.value)+" ("+t(J.value)+")",1)]),s[12]||(s[12]=e("div",{class:"sharing-disclosure"},[e("strong",null,"What joining means:"),e("p",null,"Your teacher will be able to see your practice results (which exercises you've completed and your accuracy) for assignments in this classroom. You can leave the classroom or revoke access at any time from your settings.")],-1)),C.value?g("",!0):(l(),r("div",es,[...s[10]||(s[10]=[e("p",null,"This classroom isn't ready for students yet. Please ask your teacher to check their setup.",-1)])])),e("div",os,[b(o,{to:"/",class:"btn btn-secondary"},{default:f(()=>[...s[11]||(s[11]=[u("Decline",-1)])]),_:1}),e("button",{class:"btn btn-primary",onClick:I,disabled:m.value||!C.value},t(m.value?"Joining...":"Join Classroom"),9,ts)]),d.value?(l(),r("p",as,t(d.value),1)):g("",!0)])])):n.value==="already-member"?(l(),r("div",ns,[s[16]||(s[16]=e("div",{class:"success-icon"},"âœ…",-1)),s[17]||(s[17]=e("h2",null,"Already Joined",-1)),e("p",null,[s[13]||(s[13]=u("You're already a member of ",-1)),e("strong",null,t(p.value),1),s[14]||(s[14]=u(".",-1))]),b(o,{to:"/",class:"btn btn-primary btn-full"},{default:f(()=>[...s[15]||(s[15]=[u("Go to Lobby",-1)])]),_:1})])):n.value==="success"?(l(),r("div",rs,[s[20]||(s[20]=e("div",{class:"success-icon"},"âœ…",-1)),s[21]||(s[21]=e("h2",null,"You're In!",-1)),e("p",null,[s[18]||(s[18]=u("Welcome to ",-1)),e("strong",null,t(p.value),1),u(" with "+t(y.value)+".",1)]),s[22]||(s[22]=P('<div class="info-items" data-v-b0976d98><div class="info-item" data-v-b0976d98><span class="info-icon" data-v-b0976d98>ğŸ“‹</span><span data-v-b0976d98>Assignments from your teacher will appear in your lobby</span></div><div class="info-item" data-v-b0976d98><span class="info-icon" data-v-b0976d98>ğŸ‘</span><span data-v-b0976d98>Your teacher can see your practice progress for assigned exercises</span></div><div class="info-item" data-v-b0976d98><span class="info-icon" data-v-b0976d98>âš™</span><span data-v-b0976d98>You can leave this classroom or change sharing at any time from Settings</span></div></div>',1)),b(o,{to:"/",class:"btn btn-primary btn-full"},{default:f(()=>[...s[19]||(s[19]=[u("Go to Lobby",-1)])]),_:1})])):g("",!0)])])}}},ds=Y(ls,[["__scopeId","data-v-b0976d98"]]);export{ds as default};
