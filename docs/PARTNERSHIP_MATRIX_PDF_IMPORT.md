# Partnership Matrix & PDF Import

## Overview

Two additional features for the convention card system:

1. **Partnership Matrix** â€” A printable comparison table showing convention differences across a player's various partnerships
2. **PDF Import** â€” Extract convention card data from PDF files generated by common convention card applications

---

# Part 1: Partnership Matrix

## Concept

A bridge player often has multiple partners with different agreements. The partnership matrix provides a quick-reference table highlighting what's different with each partner.

**Example Scenario:**
- Margaret plays 2/1 with Robert (husband, regular partner)
- Margaret plays SAYC with Susan (Tuesday class partner)
- Margaret plays Precision with James (tournament partner)

The matrix shows Margaret what to remember for each partnership.

## Matrix Layout

### Compact View (Print-Friendly)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MARGARET'S PARTNERSHIP MATRIX                              Generated: Feb 2026 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                           â”‚ Robert      â”‚ Susan       â”‚ James       â”‚           â”‚
â”‚  CONVENTION               â”‚ (2/1 GF)    â”‚ (SAYC)      â”‚ (Precision) â”‚ NOTES     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1NT Range                â”‚ 15-17       â”‚ 15-17       â”‚ 14-16       â”‚           â”‚
â”‚  1NT Forcing              â”‚ âœ“ Yes       â”‚ âœ— No        â”‚ âœ“ Yes       â”‚ *Alert    â”‚
â”‚  2/1 Game Force           â”‚ âœ“ Yes       â”‚ âœ— No        â”‚ âœ“ Yes       â”‚           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  2â™£ Opening               â”‚ Strong      â”‚ Strong      â”‚ Natural     â”‚ Precision â”‚
â”‚  2â™¦ Opening               â”‚ Weak        â”‚ Weak        â”‚ Artificial  â”‚ Precision â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Over Opp's 1NT           â”‚ DONT        â”‚ Cappelletti â”‚ Meckwell    â”‚ *Alert    â”‚
â”‚  Negative Dbl Through     â”‚ 3â™           â”‚ 2â™           â”‚ 4â™¥          â”‚           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Blackwood                â”‚ RKCB 1430   â”‚ Standard    â”‚ RKCB 0314   â”‚ Responses â”‚
â”‚  Gerber                   â”‚ âœ“ Yes       â”‚ âœ“ Yes       â”‚ âœ— No        â”‚           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Opening Leads            â”‚ 4th Best    â”‚ 4th Best    â”‚ 3rd/5th     â”‚           â”‚
â”‚  Attitude Signals         â”‚ Standard    â”‚ Standard    â”‚ Upside-Down â”‚           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Legend: âœ“ = Yes/On   âœ— = No/Off   Shaded cells = differs from most common choice
```

### Difference-Only View
Shows only rows where at least one partnership differs:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MARGARET'S PARTNERSHIP DIFFERENCES                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                           â”‚ Robert      â”‚ Susan       â”‚ James       â”‚           â”‚
â”‚  DIFFERS IN:              â”‚ (2/1 GF)    â”‚ (SAYC)      â”‚ (Precision) â”‚           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1NT Range                â”‚ 15-17       â”‚ 15-17       â”‚ â–‘â–‘14-16â–‘â–‘   â”‚           â”‚
â”‚  1NT Forcing              â”‚ âœ“ Yes       â”‚ â–‘â–‘âœ— Noâ–‘â–‘    â”‚ âœ“ Yes       â”‚           â”‚
â”‚  2/1 Game Force           â”‚ âœ“ Yes       â”‚ â–‘â–‘âœ— Noâ–‘â–‘    â”‚ âœ“ Yes       â”‚           â”‚
â”‚  2â™£ Opening               â”‚ Strong      â”‚ Strong      â”‚ â–‘â–‘Naturalâ–‘â–‘ â”‚           â”‚
â”‚  2â™¦ Opening               â”‚ Weak        â”‚ Weak        â”‚ â–‘â–‘Artif.â–‘â–‘  â”‚           â”‚
â”‚  Over Opp's 1NT           â”‚ â–‘â–‘DONTâ–‘â–‘    â”‚ â–‘â–‘Capp.â–‘â–‘   â”‚ â–‘â–‘Meckwellâ–‘â–‘â”‚           â”‚
â”‚  Negative Dbl Through     â”‚ 3â™           â”‚ â–‘â–‘2â™ â–‘â–‘      â”‚ â–‘â–‘4â™¥â–‘â–‘      â”‚           â”‚
â”‚  Blackwood                â”‚ â–‘â–‘1430â–‘â–‘    â”‚ â–‘â–‘Stdâ–‘â–‘     â”‚ â–‘â–‘0314â–‘â–‘    â”‚           â”‚
â”‚  Gerber                   â”‚ âœ“ Yes       â”‚ âœ“ Yes       â”‚ â–‘â–‘âœ— Noâ–‘â–‘    â”‚           â”‚
â”‚  Opening Leads            â”‚ 4th Best    â”‚ 4th Best    â”‚ â–‘â–‘3rd/5thâ–‘â–‘ â”‚           â”‚
â”‚  Attitude Signals         â”‚ Standard    â”‚ Standard    â”‚ â–‘â–‘UDCAâ–‘â–‘    â”‚           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â–‘â–‘Shadedâ–‘â–‘ = Differs from your most common agreement
```

## Data Model

### Partnership Matrix Configuration
```javascript
{
  "matrix_id": "uuid",
  "owner_id": "margaret-uuid",
  "name": "My Partnerships",
  "created_at": "2026-02-01T10:00:00Z",
  "updated_at": "2026-02-15T14:30:00Z",
  
  "partnerships": [
    {
      "partner_name": "Robert Thompson",
      "card_id": "card-uuid-1",
      "label": "2/1 GF",
      "is_primary": true,
      "display_order": 1
    },
    {
      "partner_name": "Susan Miller",
      "card_id": "card-uuid-2", 
      "label": "SAYC",
      "is_primary": false,
      "display_order": 2
    },
    {
      "partner_name": "James Kennedy",
      "card_id": "card-uuid-3",
      "label": "Precision",
      "is_primary": false,
      "display_order": 3
    }
  ],
  
  "display_options": {
    "show_all_rows": false,          // false = differences only
    "highlight_differences": true,
    "include_notes_column": true,
    "sections_to_include": [         // null = all sections
      "notrump",
      "two_level",
      "competitive",
      "slam",
      "defensive"
    ],
    "custom_rows": [                  // Additional comparison points
      {
        "label": "Special Agreements",
        "values": {
          "card-uuid-1": "None",
          "card-uuid-2": "Garbage Stayman",
          "card-uuid-3": "Asking bids"
        }
      }
    ]
  }
}
```

### Comparison Row Definition
```javascript
{
  "row_id": "nt_range",
  "label": "1NT Range",
  "category": "notrump",
  "card_paths": ["notrump.one_nt.range_min", "notrump.one_nt.range_max"],
  "format": "range",           // range, boolean, enum, text
  "format_template": "{0}-{1}",
  "comparison_key": "exact",   // exact, truthy, category
  "alert_worthy": false
}
```

### Standard Comparison Rows
```javascript
const COMPARISON_ROWS = [
  // Notrump
  { id: "nt_range", label: "1NT Range", category: "notrump",
    paths: ["notrump.one_nt.range_min", "notrump.one_nt.range_max"],
    format: "range" },
  { id: "nt_5cm", label: "1NT may have 5cM", category: "notrump",
    paths: ["notrump.one_nt.five_card_major"],
    format: "boolean" },
  { id: "stayman", label: "Stayman", category: "notrump",
    paths: ["notrump.stayman.forcing"],
    format: "boolean" },
  { id: "transfers", label: "Jacoby Transfers", category: "notrump",
    paths: ["notrump.transfers.jacoby"],
    format: "boolean" },
  { id: "texas", label: "Texas Transfers", category: "notrump",
    paths: ["notrump.transfers.texas"],
    format: "boolean" },
  { id: "lebensohl", label: "Lebensohl", category: "notrump",
    paths: ["notrump.lebensohl.over_interference"],
    format: "boolean" },
  
  // Major Openings
  { id: "1nt_forcing", label: "1NT Forcing", category: "major",
    paths: ["major_openings.one_nt_response.forcing"],
    format: "boolean", alert: true },
  { id: "2over1_gf", label: "2/1 Game Force", category: "major",
    paths: ["major_openings.two_over_one.game_force"],
    format: "boolean" },
  { id: "jacoby_2nt", label: "Jacoby 2NT", category: "major",
    paths: ["major_openings.jacoby_2nt.play"],
    format: "boolean" },
  { id: "splinters", label: "Splinters", category: "major",
    paths: ["major_openings.splinters.play"],
    format: "boolean" },
  { id: "drury", label: "Drury", category: "major",
    paths: ["major_openings.drury.play", "major_openings.drury.reverse"],
    format: "drury" },
  
  // Two-Level Openings
  { id: "2c_meaning", label: "2â™£ Opening", category: "two_level",
    paths: ["two_level.two_clubs.meaning"],
    format: "enum", alert: true },
  { id: "2d_meaning", label: "2â™¦ Opening", category: "two_level",
    paths: ["two_level.two_diamonds.meaning"],
    format: "enum", alert: true },
  { id: "weak2_range", label: "Weak 2 Range", category: "two_level",
    paths: ["two_level.two_hearts.min_hcp", "two_level.two_hearts.max_hcp"],
    format: "range" },
  { id: "ogust", label: "Ogust", category: "two_level",
    paths: ["two_level.ogust.play"],
    format: "boolean" },
  
  // Competitive
  { id: "neg_dbl_thru", label: "Negative Dbl Through", category: "competitive",
    paths: ["competitive.negative_doubles.through"],
    format: "text" },
  { id: "michaels", label: "Michaels", category: "competitive",
    paths: ["competitive.michaels.play"],
    format: "boolean" },
  { id: "unusual_2nt", label: "Unusual 2NT", category: "competitive",
    paths: ["competitive.unusual_2nt.play"],
    format: "boolean" },
  { id: "over_1nt", label: "Over Opp's 1NT", category: "competitive",
    paths: ["competitive.dont.play", "competitive.cappelletti.play"],
    format: "defense_vs_nt", alert: true },
  
  // Slam
  { id: "blackwood", label: "Blackwood", category: "slam",
    paths: ["other_conventions.blackwood.standard", "other_conventions.blackwood.rkcb_1430", 
            "other_conventions.blackwood.rkcb_0314"],
    format: "blackwood_type" },
  { id: "gerber", label: "Gerber", category: "slam",
    paths: ["other_conventions.gerber.play"],
    format: "boolean" },
  
  // Defensive
  { id: "leads_vs_suits", label: "Leads vs Suits", category: "defensive",
    paths: ["defensive.opening_leads.vs_suits.fourth_best", 
            "defensive.opening_leads.vs_suits.third_fifth"],
    format: "lead_style" },
  { id: "leads_vs_nt", label: "Leads vs NT", category: "defensive",
    paths: ["defensive.opening_leads.vs_nt.fourth_best",
            "defensive.opening_leads.vs_nt.third_fifth"],
    format: "lead_style" },
  { id: "attitude", label: "Attitude Signals", category: "defensive",
    paths: ["defensive.signals.attitude.standard", 
            "defensive.signals.attitude.upside_down"],
    format: "signal_style" },
  { id: "count", label: "Count Signals", category: "defensive",
    paths: ["defensive.signals.count.standard",
            "defensive.signals.count.upside_down"],
    format: "signal_style" },
  { id: "discards", label: "Discards", category: "defensive",
    paths: ["defensive.discards.standard", "defensive.discards.lavinthal",
            "defensive.discards.odd_even", "defensive.discards.upside_down"],
    format: "discard_style" }
];
```

## Matrix Generation Algorithm

```javascript
function generatePartnershipMatrix(partnerships, options) {
  const matrix = {
    headers: partnerships.map(p => ({
      name: p.partner_name,
      label: p.label,
      isPrimary: p.is_primary
    })),
    rows: [],
    hasDifferences: false
  };
  
  // Load all cards
  const cards = partnerships.map(p => loadCard(p.card_id));
  
  // Process each comparison row
  for (const rowDef of COMPARISON_ROWS) {
    // Skip if category not included
    if (options.sections_to_include && 
        !options.sections_to_include.includes(rowDef.category)) {
      continue;
    }
    
    // Extract values from each card
    const values = cards.map(card => extractValue(card, rowDef));
    
    // Format values for display
    const formattedValues = values.map(v => formatValue(v, rowDef.format));
    
    // Check if there are differences
    const allSame = formattedValues.every(v => v === formattedValues[0]);
    
    // Skip if showing differences only and all same
    if (!options.show_all_rows && allSame) {
      continue;
    }
    
    // Determine which values differ from the mode (most common)
    const mode = findMode(formattedValues);
    const differs = formattedValues.map(v => v !== mode);
    
    if (!allSame) {
      matrix.hasDifferences = true;
    }
    
    matrix.rows.push({
      id: rowDef.id,
      label: rowDef.label,
      category: rowDef.category,
      values: formattedValues,
      differs: differs,
      alert: rowDef.alert && !allSame
    });
  }
  
  // Add custom rows
  if (options.custom_rows) {
    for (const custom of options.custom_rows) {
      const values = partnerships.map(p => custom.values[p.card_id] || 'â€”');
      const allSame = values.every(v => v === values[0]);
      
      if (options.show_all_rows || !allSame) {
        const mode = findMode(values);
        matrix.rows.push({
          id: `custom_${custom.label}`,
          label: custom.label,
          category: 'custom',
          values: values,
          differs: values.map(v => v !== mode),
          alert: false
        });
      }
    }
  }
  
  return matrix;
}

function extractValue(card, rowDef) {
  const values = rowDef.paths.map(path => getNestedValue(card, path));
  return values;
}

function formatValue(values, format) {
  switch (format) {
    case 'range':
      return `${values[0]}-${values[1]}`;
    case 'boolean':
      return values[0] ? 'âœ“ Yes' : 'âœ— No';
    case 'enum':
      return capitalize(values[0] || 'None');
    case 'drury':
      if (!values[0]) return 'âœ— No';
      return values[1] ? 'Reverse' : 'Standard';
    case 'blackwood_type':
      if (values[0]) return 'Standard';
      if (values[1]) return 'RKCB 1430';
      if (values[2]) return 'RKCB 0314';
      return 'None';
    case 'lead_style':
      if (values[0]) return '4th Best';
      if (values[1]) return '3rd/5th';
      return 'Other';
    case 'signal_style':
      if (values[0]) return 'Standard';
      if (values[1]) return 'Upside-Down';
      return 'Other';
    case 'defense_vs_nt':
      if (values[0]) return 'DONT';
      if (values[1]) return 'Cappelletti';
      return 'Natural';
    case 'discard_style':
      if (values[0]) return 'Standard';
      if (values[1]) return 'Lavinthal';
      if (values[2]) return 'Odd-Even';
      if (values[3]) return 'Upside-Down';
      return 'Other';
    default:
      return String(values[0] || 'â€”');
  }
}

function findMode(values) {
  const counts = {};
  values.forEach(v => counts[v] = (counts[v] || 0) + 1);
  return Object.entries(counts).sort((a, b) => b[1] - a[1])[0][0];
}
```

## PDF Generation for Matrix

### Layout Options
```javascript
const MATRIX_PDF_OPTIONS = {
  orientation: 'landscape',      // Better for wide tables
  pageSize: 'letter',
  margins: { top: 36, bottom: 36, left: 36, right: 36 },
  
  fonts: {
    title: { size: 16, bold: true },
    header: { size: 10, bold: true },
    cell: { size: 9, bold: false },
    footer: { size: 8, italic: true }
  },
  
  colors: {
    headerBg: '#e3f2fd',
    differsBg: '#fff3e0',
    alertBg: '#ffebee',
    borderColor: '#bdbdbd'
  },
  
  columnWidths: {
    label: 120,
    partner: 80,                 // Per partner column
    notes: 60
  }
};
```

### PDF Structure
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [TITLE] Margaret's Partnership Matrix                                          â”‚
â”‚  [SUBTITLE] Generated February 15, 2026                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  [TABLE - as shown above]                                                       â”‚
â”‚                                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [LEGEND]                                                                       â”‚
â”‚  âœ“ = Yes/Enabled    âœ— = No/Disabled    Shaded = Differs from most common       â”‚
â”‚  *Alert = This difference requires an alert                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [FOOTER] Bridge Classroom â€¢ cards.harmonicsystems.com                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## UI for Matrix Builder

### Matrix Configuration Screen
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Partnership Matrix Builder                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  Matrix Name: [My Partnerships                    ]                             â”‚
â”‚                                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                                 â”‚
â”‚  PARTNERSHIPS TO COMPARE                                                        â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 1. Partner: [Robert Thompson     â–¼]  Card: [2/1 with Robert      â–¼]    â”‚   â”‚
â”‚  â”‚    Label:   [2/1 GF              ]   â˜‘ Primary partnership              â”‚   â”‚
â”‚  â”‚                                                                  [ğŸ—‘ï¸]   â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ 2. Partner: [Susan Miller        â–¼]  Card: [SAYC for Tuesday     â–¼]    â”‚   â”‚
â”‚  â”‚    Label:   [SAYC                ]   â˜ Primary partnership              â”‚   â”‚
â”‚  â”‚                                                                  [ğŸ—‘ï¸]   â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ 3. Partner: [James Kennedy       â–¼]  Card: [Precision w/ James   â–¼]    â”‚   â”‚
â”‚  â”‚    Label:   [Precision           ]   â˜ Primary partnership              â”‚   â”‚
â”‚  â”‚                                                                  [ğŸ—‘ï¸]   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                 â”‚
â”‚  [+ Add Another Partnership]                                                    â”‚
â”‚                                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                                 â”‚
â”‚  DISPLAY OPTIONS                                                                â”‚
â”‚                                                                                 â”‚
â”‚  â—‹ Show all conventions     â— Show only differences                            â”‚
â”‚  â˜‘ Highlight differences    â˜‘ Include notes column                             â”‚
â”‚                                                                                 â”‚
â”‚  Sections to include:                                                           â”‚
â”‚  â˜‘ Notrump  â˜‘ Major Openings  â˜‘ Minor Openings  â˜‘ Two-Level                    â”‚
â”‚  â˜‘ Competitive  â˜‘ Slam Bidding  â˜‘ Defensive                                    â”‚
â”‚                                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                                 â”‚
â”‚                    [Preview Matrix]  [Export PDF]  [Save Matrix]                â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

# Part 2: PDF Import

## Overview

Import convention cards from PDF files generated by common convention card applications. This is inherently challenging because PDFs are presentation-focused, not data-focused.

## Supported PDF Sources (Incremental)

### Phase 1: High Priority
| Source | Difficulty | Notes |
|--------|------------|-------|
| **Bridge Classroom Export** | Easy | We control the format |
| **ACBL Convention Card (fillable)** | Medium | Standard form fields |
| **BridgeWinners Card Builder** | Medium | Known structure |

### Phase 2: Medium Priority
| Source | Difficulty | Notes |
|--------|------------|-------|
| **BBO PDF Export** | Medium | Need to analyze format |
| **Bridge Baron** | Medium | Proprietary format |
| **Larry Cohen Card Builder** | Medium | Web-based, structured |

### Phase 3: Lower Priority
| Source | Difficulty | Notes |
|--------|------------|-------|
| **Hand-written scans** | Hard | Requires OCR + interpretation |
| **Unknown sources** | Hard | Best-effort extraction |

## Technical Approaches

### Approach 1: Form Field Extraction (Fillable PDFs)
For PDFs with form fields (fillable PDFs), extract field values directly.

```javascript
// Using pdf-lib or similar
async function extractFormFields(pdfBytes) {
  const pdfDoc = await PDFDocument.load(pdfBytes);
  const form = pdfDoc.getForm();
  const fields = form.getFields();
  
  const data = {};
  for (const field of fields) {
    const name = field.getName();
    const type = field.constructor.name;
    
    if (type === 'PDFTextField') {
      data[name] = field.getText();
    } else if (type === 'PDFCheckBox') {
      data[name] = field.isChecked();
    } else if (type === 'PDFDropdown') {
      data[name] = field.getSelected();
    } else if (type === 'PDFRadioGroup') {
      data[name] = field.getSelected();
    }
  }
  
  return data;
}
```

### Approach 2: Text Extraction + Pattern Matching
For non-fillable PDFs, extract text and use patterns to identify values.

```javascript
// Using pdf.js or pdftotext
async function extractTextContent(pdfBytes) {
  const pdf = await pdfjsLib.getDocument(pdfBytes).promise;
  const pages = [];
  
  for (let i = 1; i <= pdf.numPages; i++) {
    const page = await pdf.getPage(i);
    const textContent = await page.getTextContent();
    const text = textContent.items.map(item => item.str).join(' ');
    pages.push(text);
  }
  
  return pages.join('\n');
}

// Pattern matching for common conventions
const PATTERNS = {
  nt_range: /1NT[:\s]+(\d+)\s*[-â€“]\s*(\d+)/i,
  stayman: /stayman[:\s]*(yes|no|âœ“|âœ—|x)/i,
  jacoby_transfers: /jacoby\s*transfers?[:\s]*(yes|no|âœ“|âœ—|x)/i,
  weak_twos: /weak\s*(2|two)[:\s]*(yes|no|âœ“|âœ—|x)/i,
  // ... more patterns
};

function matchPatterns(text) {
  const results = {};
  
  for (const [key, pattern] of Object.entries(PATTERNS)) {
    const match = text.match(pattern);
    if (match) {
      results[key] = parseMatchValue(match[1], match[2]);
    }
  }
  
  return results;
}
```

### Approach 3: Layout-Based Extraction
For PDFs with known layouts (like ACBL card), use coordinates.

```javascript
// Define regions for ACBL card layout
const ACBL_CARD_REGIONS = {
  general: { x: 0, y: 0, width: 200, height: 100 },
  notrump: { x: 0, y: 100, width: 200, height: 150 },
  major_openings: { x: 200, y: 0, width: 200, height: 200 },
  // ... etc
};

const ACBL_FIELD_POSITIONS = [
  { field: 'notrump.one_nt.range_min', x: 50, y: 120, width: 30 },
  { field: 'notrump.one_nt.range_max', x: 90, y: 120, width: 30 },
  { field: 'notrump.stayman', x: 50, y: 140, type: 'checkbox' },
  // ... etc
];

async function extractByPosition(pdfBytes, layout) {
  // Get text with position information
  const textWithPositions = await extractTextWithPositions(pdfBytes);
  
  const results = {};
  for (const fieldDef of layout) {
    const text = findTextInRegion(textWithPositions, fieldDef);
    results[fieldDef.field] = parseFieldValue(text, fieldDef.type);
  }
  
  return results;
}
```

### Approach 4: OCR for Scanned Documents
For scanned/image-based PDFs, use OCR.

```javascript
// Using Tesseract.js
async function extractWithOCR(pdfBytes) {
  // Convert PDF pages to images
  const images = await pdfToImages(pdfBytes);
  
  const results = [];
  for (const image of images) {
    const { data: { text } } = await Tesseract.recognize(image, 'eng', {
      // Configuration for form recognition
      tessedit_pageseg_mode: '6',  // Assume uniform block of text
    });
    results.push(text);
  }
  
  return results.join('\n');
}
```

## PDF Import Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           PDF IMPORT PIPELINE                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ PDF Upload  â”‚â”€â”€â”€â–¶â”‚ PDF Analysis â”‚â”€â”€â”€â–¶â”‚ Extraction  â”‚â”€â”€â”€â–¶â”‚ Mapping      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                   â”‚                   â”‚           â”‚
â”‚                            â–¼                   â–¼                   â–¼           â”‚
â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚                     â”‚ Detect Type: â”‚    â”‚ Use best    â”‚    â”‚ Map to our   â”‚   â”‚
â”‚                     â”‚ â€¢ Has forms? â”‚    â”‚ approach:   â”‚    â”‚ card schema  â”‚   â”‚
â”‚                     â”‚ â€¢ Known fmt? â”‚    â”‚ â€¢ Forms     â”‚    â”‚              â”‚   â”‚
â”‚                     â”‚ â€¢ Scanned?   â”‚    â”‚ â€¢ Text      â”‚    â”‚              â”‚   â”‚
â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â€¢ Position  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚ â€¢ OCR       â”‚           â”‚           â”‚
â”‚                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚           â”‚
â”‚                                                                   â–¼           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ User Review â”‚â—€â”€â”€â”€â”‚ Confidence   â”‚â—€â”€â”€â”€â”‚ Validation & Gap Detection      â”‚   â”‚
â”‚  â”‚ & Correct   â”‚    â”‚ Scoring      â”‚    â”‚ â€¢ Required fields present?      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â€¢ Values in valid ranges?       â”‚   â”‚
â”‚        â”‚                                 â”‚ â€¢ Consistency checks            â”‚   â”‚
â”‚        â–¼                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                               â”‚
â”‚  â”‚ Save Card   â”‚                                                               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                               â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Source Detection

```javascript
async function detectPDFSource(pdfBytes) {
  const pdfDoc = await PDFDocument.load(pdfBytes);
  
  // Check metadata
  const producer = pdfDoc.getProducer();
  const creator = pdfDoc.getCreator();
  const title = pdfDoc.getTitle();
  
  // Check for form fields
  const form = pdfDoc.getForm();
  const hasFields = form.getFields().length > 0;
  
  // Check for specific markers
  const text = await extractTextContent(pdfBytes);
  
  // Detection logic
  if (producer?.includes('Bridge Classroom')) {
    return { source: 'bridge_classroom', confidence: 1.0 };
  }
  
  if (title?.includes('ACBL Convention Card') || text.includes('ACBL')) {
    return { 
      source: 'acbl_standard',
      hasFields,
      confidence: 0.9
    };
  }
  
  if (text.includes('BridgeWinners')) {
    return { source: 'bridgewinners', confidence: 0.8 };
  }
  
  if (producer?.includes('BBO') || text.includes('Bridge Base Online')) {
    return { source: 'bbo', confidence: 0.8 };
  }
  
  // Unknown source - try generic extraction
  return { source: 'unknown', confidence: 0.5 };
}
```

## Source-Specific Extractors

### ACBL Fillable Card Extractor
```javascript
const ACBL_FIELD_MAPPING = {
  // General
  'GeneralApproach': 'general.system',
  
  // Notrump
  'NT1Min': 'notrump.one_nt.range_min',
  'NT1Max': 'notrump.one_nt.range_max',
  'Stayman': 'notrump.stayman.forcing',
  'JacobyTransfers': 'notrump.transfers.jacoby',
  'TexasTransfers': 'notrump.transfers.texas',
  
  // 2-Level
  '2CStrong': 'two_level.two_clubs.meaning',
  '2DWeak': 'two_level.two_diamonds.meaning',
  
  // ... more mappings
};

async function extractACBLCard(pdfBytes) {
  const formData = await extractFormFields(pdfBytes);
  const card = createEmptyCard();
  
  for (const [pdfField, cardPath] of Object.entries(ACBL_FIELD_MAPPING)) {
    if (formData.hasOwnProperty(pdfField)) {
      setNestedValue(card, cardPath, formData[pdfField]);
    }
  }
  
  return {
    card,
    confidence: calculateConfidence(card),
    missingFields: findMissingFields(card)
  };
}
```

### Generic Text Extractor
```javascript
async function extractGenericCard(pdfBytes) {
  const text = await extractTextContent(pdfBytes);
  const card = createEmptyCard();
  const confidence = {};
  
  // Try pattern matching
  const patterns = matchPatterns(text);
  
  // Try to identify structure
  const sections = identifySections(text);
  
  // Combine results
  for (const [key, value] of Object.entries(patterns)) {
    const cardPath = PATTERN_TO_CARD_PATH[key];
    if (cardPath) {
      setNestedValue(card, cardPath, value.value);
      confidence[cardPath] = value.confidence;
    }
  }
  
  return {
    card,
    confidence,
    rawText: text,
    needsReview: Object.values(confidence).some(c => c < 0.7)
  };
}
```

## User Review Interface

After import, show user what was extracted with confidence indicators:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PDF Import Review                                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  Source detected: ACBL Convention Card (fillable PDF)                           â”‚
â”‚  Overall confidence: 87%                                                        â”‚
â”‚                                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                                 â”‚
â”‚  EXTRACTED VALUES                                            Confidence         â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 1NT Range                    [15] - [17]                   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 95% â”‚   â”‚
â”‚  â”‚ Stayman                      [âœ“ Checked]                   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 98% â”‚   â”‚
â”‚  â”‚ Jacoby Transfers             [âœ“ Checked]                   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 98% â”‚   â”‚
â”‚  â”‚ 2â™£ Opening                   [Strong    â–¼]                 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 75% â”‚   â”‚
â”‚  â”‚ Negative Doubles Through     [3S        â–¼]                 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘ 60% â”‚   â”‚
â”‚  â”‚ Opening Leads                [          ] â† Not found      â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  0% â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                 â”‚
â”‚  âš ï¸  3 fields could not be extracted. Please fill in manually.                  â”‚
â”‚                                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                                 â”‚
â”‚  PREVIEW                                                                        â”‚
â”‚  [Toggle: Extracted Card | Original PDF side-by-side]                           â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Extracted Card               â”‚  â”‚ Original PDF                 â”‚            â”‚
â”‚  â”‚                              â”‚  â”‚                              â”‚            â”‚
â”‚  â”‚ 1NT: 15-17                   â”‚  â”‚ [PDF page image]             â”‚            â”‚
â”‚  â”‚ â˜‘ Stayman                    â”‚  â”‚                              â”‚            â”‚
â”‚  â”‚ â˜‘ Transfers                  â”‚  â”‚                              â”‚            â”‚
â”‚  â”‚ ...                          â”‚  â”‚                              â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                                 â”‚
â”‚                              [Cancel]  [Edit & Save Card]                       â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Database Schema Additions

### PDF Import History
```sql
CREATE TABLE pdf_imports (
  id TEXT PRIMARY KEY,
  user_id TEXT REFERENCES users(id),
  filename TEXT NOT NULL,
  file_hash TEXT NOT NULL,              -- To detect re-imports
  detected_source TEXT,
  extraction_confidence REAL,
  raw_extracted_data JSON,
  resulting_card_id TEXT REFERENCES convention_cards(id),
  imported_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  
  UNIQUE(user_id, file_hash)            -- Prevent duplicate imports
);
```

### Source Mappings (Admin-Editable)
```sql
CREATE TABLE pdf_source_mappings (
  id TEXT PRIMARY KEY,
  source_name TEXT NOT NULL,            -- 'acbl_standard', 'bbo', etc.
  version TEXT,                         -- Source version if applicable
  field_mappings JSON NOT NULL,         -- PDF field â†’ card path mappings
  patterns JSON,                        -- Regex patterns for text extraction
  layout JSON,                          -- Position-based extraction rules
  active BOOLEAN NOT NULL DEFAULT true,
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);
```

## API Endpoints

### PDF Import
```
POST /api/cards/import/pdf
  Upload PDF for import
  Body: multipart/form-data with PDF file
  â†’ { 
      import_id,
      detected_source,
      confidence,
      extracted_card,
      needs_review: true/false,
      missing_fields: [...] 
    }

POST /api/cards/import/:import_id/confirm
  Confirm import after user review
  Body: { card_data } (possibly edited)
  â†’ { card_id }

GET /api/cards/import/sources
  List supported PDF sources
  â†’ { sources: [{ name, supported_features, confidence_typical }] }
```

### Partnership Matrix
```
POST /api/matrix
  Create a partnership matrix
  Body: { name, partnerships, display_options }
  â†’ { matrix_id }

GET /api/matrix/:id
  Get matrix configuration
  â†’ { matrix }

GET /api/matrix/:id/generate
  Generate matrix comparison data
  â†’ { headers, rows, has_differences }

GET /api/matrix/:id/pdf
  Generate PDF of matrix
  â†’ PDF file download

PUT /api/matrix/:id
  Update matrix configuration
  Body: { name?, partnerships?, display_options? }
  â†’ { success }

DELETE /api/matrix/:id
  Delete matrix
  â†’ { success }

GET /api/matrix?owner_id=<uuid>
  List user's matrices
  â†’ { matrices: [...] }
```

---

## Implementation Priority

### Phase 1: Core Features
1. Partnership matrix generation (comparison logic)
2. Matrix PDF export
3. Bridge Classroom PDF import (our own export)
4. ACBL fillable PDF import

### Phase 2: Extended Support
5. Matrix UI builder
6. BBO PDF import
7. BridgeWinners import
8. Generic text extraction

### Phase 3: Advanced
9. OCR for scanned cards
10. Machine learning for unknown formats
11. Community-contributed mappings
